local ZR = {}

ZR.patterns = {
    new = {
        motorik_1 = {
            {1,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0,1,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0},
            {1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0,1,0,0,0,0,1,0,0,1,0,1,0},
            {0,0,0,0,1,0,1,1,0,0,0,0,1,0,1,1,0,0,0,0,1,0,1,1,0,0,0,0,1,0,1,1},
            {1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0},
        },
        motorik_2 = {
            {1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0},
            {0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,1},
            {1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,0,0},
            {1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0},
        },
        motorik_3 = {
            {1,1,0,0,0,0,0,0,1,0,1,0,0,0,0,0,1,1,0,0,0,0,0,0,1,0,1,0,0,0,0,0},
            {0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,1,0},
            {1,0,1,1,1,0,0,1,1,0,1,1,1,0,0,1,1,0,1,1,1,0,0,1,1,0,1,1,1,0,0,1},
            {1,0,0,0,0,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        },
        pop_1 = {
            {1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0},
            {0,0,1,0,0,1,0,0,1,0,1,1,0,0,0,0,0,0,1,0,0,1,0,0,1,0,1,1,0,0,1,0},
            {0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,1},
            {1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1},
        },
        pop_2 = {
            {0,0,1,0,1,0,1,1,1,0,1,0,0,0,1,1,1,0,1,0,0,0,1,1,1,0,1,0,0,0,1,0},
            {0,0,1,0,1,0,1,1,1,0,1,0,0,0,1,1,1,0,1,0,0,0,1,1,1,0,1,0,0,0,1,0},
            {0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0},
            {0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0},
        },
        pop_3 = {
            {1,0,1,0,1,1,1,1,1,0,1,0,0,0,1,1,1,0,1,0,0,0,1,1,1,0,1,0,1,0,0,0},
            {1,0,1,0,1,1,1,1,1,0,1,0,0,0,1,1,1,0,1,0,0,0,1,1,1,0,1,0,1,0,0,0},
            {0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,1,0},
            {0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,1,0},
        },
        pop_4 = {
            {1,0,1,1,0,1,1,0,0,0,0,0,1,1,1,1,1,0,1,1,0,1,1,0,0,0,0,0,1,1,1,1},
            {1,0,1,1,0,1,1,0,0,0,0,0,1,1,1,1,1,0,1,1,0,1,1,0,0,0,0,0,1,1,1,1},
            {1,1,1,1,1,0,1,0,0,0,1,0,1,1,1,1,1,0,1,0,0,0,1,1,1,0,1,0,1,1,0,0},
            {1,1,1,1,1,0,1,0,0,0,1,0,1,1,1,1,1,0,1,0,0,0,1,1,1,0,1,0,1,1,0,0},
        },
        funk_1 = {
            {1,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0},
            {0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0},
            {0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1},
            {0,1,0,0,0,1,0,0,0,1,0,0,0,1,1,1},
        },
        funk_2 = {
            {0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0},
            {1,0,1,1,0,1,1,1,1,0,1,0,0,1,1,1},
            {0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1},
            {0,1,0,0,0,1,0,0,0,1,0,0,0,1,1,1},
        },
        funk_3 = {
            {1,0,1,1,0,1,1,1,1,0,1,0,0,1,1,1},
            {1,0,0,1,1,0,0,1,1,0,0,1,1,0,1,0},
            {0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1},
            {0,1,0,0,0,1,0,0,0,1,0,0,0,1,1,1},
        },
        post = {
            {1,0,0,1,0,1,0,1,1,1,0,0,1,0,1,0,1,0,1,0},
            {1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0},
            {0,0,0,1,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0},
            {1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0},
        },
        sequence = {
            {1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0},
            {0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0},
            {0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0},
            {0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1},
        },
        prime_2 = {
            {1,0,0,0,0,0,0,0,0,0,0,0},
            {1,0,0,0,0,0,1,0,0,0,0,0},
            {1,0,0,1,0,0,1,0,0,1,0,0},
            {1,1,1,1,1,1,1,1,1,1,1,1},
        },
        prime_322 = {
            {1,0,0,0,0,0,0,0,0,0,0,0},
            {1,0,0,0,0,0,1,0,0,0,0,0},
            {1,0,0,1,0,0,1,0,0,1,0,0},
            {1,1,1,1,1,1,1,1,1,1,1,1},
        },
    },
    old = {
        king_1 = {
            {1,0,1,0,1,1,0,1,0,1,0,1},
            {1,0,1,0,1,1,0,1,0,1,0,1},
            {1,0,1,1,0,1,0,0,1,1,0,0},
            {1,0,1,1,0,1,0,0,1,1,0,0},
        },
        king_2 = {
            {1,0,1,1,0,1,0,0,1,1,0,0},
            {1,0,1,1,0,1,0,0,0,1,0,0},
            {1,0,1,0,1,1,0,1,0,1,0,1},
            {1,0,1,0,1,1,0,1,0,1,0,1},
        },
        kroboto = {
            {0,0,1,0,1,1,0,0,1,0,1,1},
            {0,0,1,0,1,1,0,0,1,0,1,1},
            {1,0,0,0,0,0,1,0,0,1,0,0},
            {1,0,1,0,1,1,0,1,0,1,0,1},
        },
        vodou_1 = {
            {1,0,1,0,1,0,1,1,0,1,0,1},
            {1,0,1,0,1,0,1,1,0,1,0,1},
            {1,0,0,0,0,0,1,0,0,1,0,0},
            {0,0,0,0,1,1,0,0,0,0,1,1},
        },
        vodou_2 = {
            {0,1,1,0,1,1,0,1,1,0,1,1},
            {0,1,1,0,1,1,0,1,1,0,1,1},
            {1,0,1,0,1,0,1,1,0,1,0,1},
            {0,0,0,0,1,1,0,0,0,0,1,1},
        },
        vodou_3 = {
            {1,0,0,0,0,0,1,0,0,1,0,0},
            {1,0,0,0,0,0,1,0,0,1,0,0},
            {0,1,1,0,1,1,0,1,1,0,1,1},
            {0,0,0,0,1,1,0,0,0,0,1,1},
        },
        gahu = {
            {1,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0},
            {1,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0},
            {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
            {1,0,0,1,0,0,0,1,0,0,0,1,0,1,0,0},
        },
        clave = {
            {1,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0},
            {1,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0},
            {1,0,1,1,0,1,0,1,1,0,1,0,1,1,0,1},
            {0,0,1,1,0,0,1,1,0,0,1,0,0,0,1,1},
        },
        rhumba = {
            {1,0,0,1,0,0,0,1,0,0,1,0,1,0,0,0},
            {1,0,0,1,0,0,0,1,0,0,1,0,1,0,0,0},
            {1,0,1,1,0,1,0,1,1,0,1,0,1,1,0,1},
            {0,0,1,1,0,0,1,1,0,0,1,0,0,0,1,1},
        },
        jhaptal_1 = {
            {0,1,0,0,1,1,1,0,0,1},
            {0,1,0,0,1,1,1,0,0,1},
            {1,0,1,1,0,0,0,1,1,0},
            {1,0,0,0,0,1,0,0,0,0},
        },
        jhaptal_2 = {
            {1,0,0,0,0,0,0,0,0,0},
            {1,0,1,1,0,0,0,1,1,0},
            {1,0,1,1,0,0,0,1,1,0},
            {1,0,0,0,0,1,0,0,0,0},
        },
        chacar = {
            {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
            {1,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0},
            {0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0},
            {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1},
        },
        mata = {
            {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0},
            {1,0,0,0,1,0,1,0,0,0,0,0,1,0,0,1,0,0},
            {1,0,0,0,1,0,1,0,0,0,0,0,1,1,0,1,0,1},
            {0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,1},
        },
        pashto = {
            {1,0,0,0,0,0,0,0,0,0,0,0,0,0},
            {0,0,0,0,1,1,0,0,0,0,0,0,1,0},
            {0,0,0,0,1,1,0,0,0,0,0,0,1,0},
            {1,0,0,0,0,0,1,0,0,0,1,0,0,0},
        },
        prime_232 = {
            {1,0,0,0,0,0,0,0,0,0,0,0},
            {1,0,0,0,0,0,1,0,0,0,0,0},
            {1,0,1,0,1,0,1,0,1,0,1,0},
            {1,1,1,1,1,1,1,1,1,1,1,1},
        },
    },
}

function ZR.new(world, bank, child, offset)
    world, bank, child, offset = world or 'new', bank or 'motorik_1', child or 1, offset or 0
    local pattern = ZR.patterns[world][bank][child]
    local zr = {pattern=pattern, offset=offset, ix=1, length=#pattern}
    setmetatable(zr, ZR)
    return zr
end

function ZR.next(self)
    local offset_ix = (((self.ix + self.offset) - 1) % self.length) + 1
    self.ix = (self.ix % self.length) + 1
    return self.pattern[offset_ix]
end

ZR.__call = function(self, ...)
    return (self == ZR) and ZR.new(...) or ZR.next(self, ...)
end

setmetatable(ZR, ZR)

return ZR